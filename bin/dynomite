#!/usr/bin/env ruby

require 'optparse'

options = {}
options[:port] = 11222
options[:name] = 'dynomite'

OptionParser.new do |opts|
  opts.banner = "Usage: dynomite [options]"

  opts.separator ""
  opts.separator "Specific options:"
  
  opts.on("-p", "--port", "The port to listen on") do |port|
    options[:port] = port
  end
  
  opts.on("-n", "--name", "The erlang nodename") do |name|
    options[:name] = name
  end
  
  opts.on("-s", "--sasl-log", "sasl log path") do |log|
    options[:sasl] = "-sasl sasl_error_logger #{log}"
  end
  
  opts.on("-l", "--log", "error log path") do |log|
    options[:log] = "-kernel error_logger #{log}"
  end
end.parse!

str = "erl \
  -boot start_sasl \
  +K true \
  -smp enable \
  -pz ./ebin/ \
  -sname #{options[:name]} \
  -dynomite port #{options[:port]} \
  #{options[:sasl]} \
  #{options[:log]} \
  -mnesia dir '\"/tmp/mbd\"' \
  -noshell \
  -run dynomite start"
  
exec str